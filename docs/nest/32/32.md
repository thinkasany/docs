[SQL 查询语句的所有语法和函数](https://juejin.cn/book/7226988578700525605/section/7238472325102829629)

## 建表

### 我们先建个表：

```sql
CREATE TABLE student(
    id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'Id',
    name VARCHAR(50) NOT NULL COMMENT '学生名',
    gender VARCHAR(10) NOT NULL COMMENT '性别',
    age INT NOT NULL COMMENT '年龄',
    class VARCHAR(50) NOT NULL COMMENT '班级名',
    score INT NOT NULL COMMENT '分数'
) CHARSET=utf8mb4
```

这是学生表。

id 为主键，设置自动增长。

name 为名字，非空。

gender 为性别，非空。

age 为年龄，非空。

class 为班级名，非空。

score 为成绩，非空。

### 删表

```
drop table student;
```

### 查表

```
SELECT * FROM student;
```

### 插入数据

```
INSERT INTO student (name, gender, age, class, score)
    VALUES
        ('张三', '男',18, '一班',90),
        ('李四', '女',19, '二班',85),
        ('王五', '男',20, '三班',70),
        ('赵六', '女',18, '一班',95),
        ('钱七', '男',19, '二班',80),
        ('孙八', '女',20, '三班',75),
        ('周九', '男',18, '一班',85),
        ('吴十', '女',19, '二班',90),
        ('郑十一', '男',20, '三班',60),
        ('王十二', '女',18, '一班',95),
        ('赵十三', '男',19, '二班',75),
        ('钱十四', '女',20, '三班',80),
        ('孙十五', '男',18, '一班',90),
        ('周十六', '女',19, '二班',85),
        ('吴十七', '男',20, '三班',70),
        ('郑十八', '女',18, '一班',95),
        ('王十九', '男',19, '二班',80),
        ('赵二十', '女',20, '三班',75);
```

## sql练习

### 首先，查询是可以指定查询的列的：

```
SELECT name, score FROM student;
```

```
+-----------+-------+
| name      | score |
+-----------+-------+
| 张三      |    90 |
| 李四      |    85 |
| 王五      |    70 |
| 赵六      |    95 |
| 钱七      |    80 |
| 孙八      |    75 |
| 周九      |    85 |
| 吴十      |    90 |
| 郑十一    |    60 |
| 王十二    |    95 |
| 赵十三    |    75 |
| 钱十四    |    80 |
| 孙十五    |    90 |
| 周十六    |    85 |
| 吴十七    |    70 |
| 郑十八    |    95 |
| 王十九    |    80 |
| 赵二十    |    75 |
+-----------+-------+
```

select \* 是查询所有列的意思。

可以通过 as 修改返回的列名：

```
SELECT name as "名字", score as "分数" FROM student;
```

```
+-----------+--------+
| 名字      | 分数   |
+-----------+--------+
| 张三      |     90 |
| 李四      |     85 |
| 王五      |     70 |
| 赵六      |     95 |
| 钱七      |     80 |
| 孙八      |     75 |
| 周九      |     85 |
| 吴十      |     90 |
| 郑十一    |     60 |
| 王十二    |     95 |
| 赵十三    |     75 |
| 钱十四    |     80 |
| 孙十五    |     90 |
| 周十六    |     85 |
| 吴十七    |     70 |
| 郑十八    |     95 |
| 王十九    |     80 |
| 赵二十    |     75 |
+-----------+--------+
```

## where and 查询

查询自然是可以带条件的，通过 where, 并且条件可以是 and 连接的多个：

```
select name as '名字',class as '班级' from student where gender='男' and score >= 90;
```

```
+-----------+--------+
| 名字      | 班级   |
+-----------+--------+
| 张三      | 一班   |
| 孙十五    | 一班   |
+-----------+--------+
```

## LIKE 做模糊查询

可以看到，有两个成绩在 90 以上的男生。
比如查询名字以“王”开头的学生：

```
select * from student where name like '王%';
```

```
+----+-----------+--------+-----+--------+-------+
| id | name      | gender | age | class  | score |
+----+-----------+--------+-----+--------+-------+
|  3 | 王五      | 男     |  20 | 三班   |    70 |
| 10 | 王十二    | 女     |  18 | 一班   |    95 |
| 17 | 王十九    | 男     |  19 | 二班   |    80 |
+----+-----------+--------+-----+--------+-------+
```

## in 来指定一个集合

```
select * from student where class in ('一班', '二班');
```

```
+----+-----------+--------+-----+--------+-------+
| id | name      | gender | age | class  | score |
+----+-----------+--------+-----+--------+-------+
|  1 | 张三      | 男     |  18 | 一班   |    90 |
|  2 | 李四      | 女     |  19 | 二班   |    85 |
|  4 | 赵六      | 女     |  18 | 一班   |    95 |
|  5 | 钱七      | 男     |  19 | 二班   |    80 |
|  7 | 周九      | 男     |  18 | 一班   |    85 |
|  8 | 吴十      | 女     |  19 | 二班   |    90 |
| 10 | 王十二    | 女     |  18 | 一班   |    95 |
| 11 | 赵十三    | 男     |  19 | 二班   |    75 |
| 13 | 孙十五    | 男     |  18 | 一班   |    90 |
| 14 | 周十六    | 女     |  19 | 二班   |    85 |
| 16 | 郑十八    | 女     |  18 | 一班   |    95 |
| 17 | 王十九    | 男     |  19 | 二班   |    80 |
+----+-----------+--------+-----+--------+-------+
```

## not in

```
select * from student where class not in ('一班', '二班');
```

```
+----+-----------+--------+-----+--------+-------+
| id | name      | gender | age | class  | score |
+----+-----------+--------+-----+--------+-------+
|  3 | 王五      | 男     |  20 | 三班   |    70 |
|  6 | 孙八      | 女     |  20 | 三班   |    75 |
|  9 | 郑十一    | 男     |  20 | 三班   |    60 |
| 12 | 钱十四    | 女     |  20 | 三班   |    80 |
| 15 | 吴十七    | 男     |  20 | 三班   |    70 |
| 18 | 赵二十    | 女     |  20 | 三班   |    75 |
+----+-----------+--------+-----+--------+-------+
```

## in 集合，通过between and 指定区间

```
select * from student where age between 18 and 19;
```

```
+----+-----------+--------+-----+--------+-------+
| id | name      | gender | age | class  | score |
+----+-----------+--------+-----+--------+-------+
|  1 | 张三      | 男     |  18 | 一班   |    90 |
|  2 | 李四      | 女     |  19 | 二班   |    85 |
|  4 | 赵六      | 女     |  18 | 一班   |    95 |
|  5 | 钱七      | 男     |  19 | 二班   |    80 |
|  7 | 周九      | 男     |  18 | 一班   |    85 |
|  8 | 吴十      | 女     |  19 | 二班   |    90 |
| 10 | 王十二    | 女     |  18 | 一班   |    95 |
| 11 | 赵十三    | 男     |  19 | 二班   |    75 |
| 13 | 孙十五    | 男     |  18 | 一班   |    90 |
| 14 | 周十六    | 女     |  19 | 二班   |    85 |
| 16 | 郑十八    | 女     |  18 | 一班   |    95 |
| 17 | 王十九    | 男     |  19 | 二班   |    80 |
+----+-----------+--------+-----+--------+-------+
```

## limit分页返回

```
select * from student limit 0,3;
```

这种也可以简化为：

```
select * from student limit 3;
```

```
+----+--------+--------+-----+--------+-------+
| id | name   | gender | age | class  | score |
+----+--------+--------+-----+--------+-------+
|  1 | 张三   | 男     |  18 | 一班   |    90 |
|  2 | 李四   | 女     |  19 | 二班   |    85 |
|  3 | 王五   | 男     |  20 | 三班   |    70 |
+----+--------+--------+-----+--------+-------+
```

## order by 指定排序的列

```
select name,score,age from student order by score asc,age desc;
```

order by 指定根据 score 升序排列，如果 score 相同再根据 age 降序排列。

```
+-----------+-------+-----+
| name      | score | age |
+-----------+-------+-----+
| 郑十一    |    60 |  20 |
| 王五      |    70 |  20 |
| 吴十七    |    70 |  20 |
| 孙八      |    75 |  20 |
| 赵二十    |    75 |  20 |
| 赵十三    |    75 |  19 |
| 钱十四    |    80 |  20 |
| 钱七      |    80 |  19 |
| 王十九    |    80 |  19 |
| 李四      |    85 |  19 |
| 周十六    |    85 |  19 |
| 周九      |    85 |  18 |
| 吴十      |    90 |  19 |
| 张三      |    90 |  18 |
| 孙十五    |    90 |  18 |
| 赵六      |    95 |  18 |
| 王十二    |    95 |  18 |
| 郑十八    |    95 |  18 |
+-----------+-------+-----+
```

## HAVING

WHERE 子句用于在分组之前筛选行，它作用于单个行级数据，即在数据进行分组之前，用于过滤原始数据集中的行。它通常用于筛选数据，而不是用于聚合后的结果。

HAVING 子句用于在分组后筛选数据，它作用于分组后的结果集，用于过滤聚合数据。HAVING 子句允许你在分组后对聚合结果进行筛选，并且可以使用聚合函数（如 SUM、COUNT、AVG 等）进行条件筛选。

```
SELECT class,AVG(score) AS avg_score FROM student GROUP BY class HAVING avg_score > 90;
```

```
+--------+-----------+
| class  | avg_score |
+--------+-----------+
| 一班   |   91.6667 |
+--------+-----------+
```

## distinct 去重

```
SELECT DISTINCT class FROM student;
```

```
+--------+
| class  |
+--------+
| 一班   |
| 二班   |
| 三班   |
+--------+
```
